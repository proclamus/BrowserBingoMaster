<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Bingo Master</title>
    <style>
        :root { --primary: #2196F3; --secondary: #FF9800; --bg: #f4f7f6; --success: #4CAF50; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        .screen { display: none; width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; }
        .active { display: block; }

        /* UI Cards */
        .card-ui { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 14px; margin-bottom: 5px; color: #555; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* Bot√µes */
        button { width: 100%; padding: 15px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .btn-blue { background: var(--primary); }
        .btn-orange { background: var(--secondary); }
        .btn-back { background: #666; }

        /* Sorteador */
        .big-number { font-size: 80px; font-weight: bold; color: var(--secondary); text-align: center; margin: 10px 0; line-height: 1; }
        .history { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 15px; background: #eee; padding: 12px; border-radius: 8px; max-height: 120px; overflow-y: auto; border: 1px solid #ddd; }
        .history-item { background: white; padding: 4px 10px; border-radius: 5px; font-size: 13px; border: 1px solid #ccc; font-weight: bold; }

        /* Grid da Cartela */
        .grid { display: grid; gap: 4px; background: #bbb; padding: 4px; border-radius: 4px; margin-top: 10px; }
        .cell { 
            background: white; aspect-ratio: 1/1; display: flex; align-items: center; 
            justify-content: center; font-weight: bold; cursor: pointer; position: relative; 
            font-size: clamp(10px, 4vw, 16px); text-align: center; overflow: hidden;
        }
        .cell.marked::after { content: "X"; color: rgba(255,0,0,0.7); position: absolute; font-size: 2em; font-weight: bold; z-index: 3; }
        .cell.free-space { background: #fff3e0; color: #e65100; font-size: 0.7em; cursor: default; }
        
        /* Riscos de Vit√≥ria */
        .line-h::before { content: ""; position: absolute; width: 100%; height: 4px; background: rgba(76, 175, 80, 0.5); z-index: 2; }
        .line-v::after { content: ""; position: absolute; height: 100%; width: 4px; background: rgba(76, 175, 80, 0.5); z-index: 2; }
        
        .bingo-win-msg { color: var(--success); text-align: center; font-weight: bold; font-size: 22px; display: none; margin-bottom: 10px; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }
    </style>
</head>
<body>

    <div id="menu" class="screen active">
        <div class="card-ui">
            <h2 style="text-align: center; color: var(--primary);">Browser Bingo Master</h2>
            
            <div class="input-group">
                <label>N M√°ximo (Sorteio de 1 at√©...)</label>
                <input type="number" id="maxN" value="75">
            </div>

            <div class="input-group">
                <label>Total de N√∫meros na Cartela</label>
                <input type="number" id="totalCells" value="24" placeholder="Ex: 24 para grade 5x5">
            </div>

            <div class="input-group">
                <label>Quantidade de Cartelas</label>
                <select id="cardQty">
                    <option value="1">1 Cartela</option>
                    <option value="2">2 Cartelas</option>
                    <option value="3">3 Cartelas</option>
                    <option value="4">4 Cartelas</option>
                </select>
            </div>

            <div class="input-group">
                <label>Ordena√ß√£o dos N√∫meros</label>
                <select id="orderMode">
                    <option value="H">Horizontal (Linha por Linha)</option>
                    <option value="V">Vertical (Coluna por Coluna)</option>
                </select>
            </div>

            <button class="btn-blue" onclick="initGame()">GERAR CARTELAS</button>
            <button class="btn-orange" onclick="openSorteador()">ABRIR SORTEADOR</button>
        </div>
    </div>

    <div id="sorteador" class="screen">
        <div class="card-ui">
            <h3 style="text-align: center; margin-top: 0;">Sorteador Central</h3>
            <div id="numDisplay" class="big-number">--</div>
            <div id="statusMsg" style="color:red; text-align:center; font-weight:bold; height: 20px; margin-bottom: 10px;"></div>
            
            <button id="drawBtn" class="btn-orange" onclick="drawNext()">SORTEAR PR√ìXIMO</button>
            
            <p style="margin: 15px 0 5px 0; font-size: 14px; color: #666;">Hist√≥rico (Ordem Crescente):</p>
            <div id="historyBox" class="history"></div>
            
            <button class="btn-back" onclick="goTo('menu')">VOLTAR AO MENU</button>
        </div>
    </div>

    <div id="game" class="screen">
        <div id="cardsArea"></div>
        <button class="btn-back" onclick="goTo('menu')">SAIR DO JOGO</button>
    </div>

    <script>
        let pool = [];
        let drawnNumbers = [];

        function goTo(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // L√ìGICA DO SORTEADOR
        function openSorteador() {
            const n = parseInt(document.getElementById('maxN').value) || 75;
            pool = Array.from({length: n}, (_, i) => i + 1);
            drawnNumbers = [];
            document.getElementById('numDisplay').innerText = "--";
            document.getElementById('historyBox').innerHTML = "";
            document.getElementById('statusMsg').innerText = "";
            document.getElementById('drawBtn').disabled = false;
            goTo('sorteador');
        }

        function drawNext() {
            if (pool.length === 0) return;
            
            const idx = Math.floor(Math.random() * pool.length);
            const num = pool.splice(idx, 1)[0];
            drawnNumbers.push(num);
            
            document.getElementById('numDisplay').innerText = num;
            
            // Atualizar hist√≥rico ordenado
            const sorted = [...drawnNumbers].sort((a,b) => a - b);
            document.getElementById('historyBox').innerHTML = sorted.map(n => `<span class="history-item">${n}</span>`).join('');

            if (pool.length === 0) {
                document.getElementById('statusMsg').innerText = "Fim de jogo (N√£o h√° mais n√∫meros)";
                document.getElementById('drawBtn').disabled = true;
            }
        }

        // L√ìGICA DAS CARTELAS
        function initGame() {
            const totalRequested = parseInt(document.getElementById('totalCells').value) || 24;
            const nMax = parseInt(document.getElementById('maxN').value) || 75;
            const qty = parseInt(document.getElementById('cardQty').value);
            const mode = document.getElementById('orderMode').value;
            
            // Define o tamanho da grade quadrada (ex: 24 -> 5x5)
            let size = Math.ceil(Math.sqrt(totalRequested));
            if (size % 2 === 0 && totalRequested > (size * size)) size++; // ajuste simples
            
            const hasFreeSpace = (size % 2 !== 0); 
            const middleIdx = Math.floor((size * size) / 2);
            const numbersNeeded = hasFreeSpace ? (size * size) - 1 : (size * size);

            if (nMax < numbersNeeded) {
                alert("Erro: O 'N M√°ximo' deve ser maior ou igual ao total de n√∫meros da cartela (" + numbersNeeded + ").");
                return;
            }

            const area = document.getElementById('cardsArea');
            area.innerHTML = "";

            for (let i = 0; i < qty; i++) {
                area.appendChild(createBingoCard(nMax, size, mode, hasFreeSpace, middleIdx));
            }
            goTo('game');
        }

        function createBingoCard(nMax, size, mode, hasFreeSpace, middleIdx) {
            const cardContainer = document.createElement('div');
            cardContainer.className = 'card-ui';
            
            const winMsg = document.createElement('div');
            winMsg.className = 'bingo-win-msg';
            winMsg.innerText = "üéâ BINGO! üéâ";

            const grid = document.createElement('div');
            grid.className = 'grid';
            grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;

            // Gerar n√∫meros √∫nicos
            let nums = [];
            while(nums.length < (hasFreeSpace ? (size*size)-1 : size*size)) {
                let r = Math.floor(Math.random() * nMax) + 1;
                if(!nums.includes(r)) nums.push(r);
            }
            nums.sort((a,b) => a - b);

            // Mapear n√∫meros para as c√©lulas
            let cellsData = [];
            let nPointer = 0;
            
            // Pre-preencher estrutura
            for(let i=0; i < size*size; i++) {
                if(hasFreeSpace && i === middleIdx) {
                    cellsData.push({ type: 'free', val: 'BINGO' });
                } else {
                    cellsData.push({ type: 'num', val: 0 });
                }
            }

            // Distribuir n√∫meros conforme ordena√ß√£o
            if(mode === 'H') {
                cellsData.forEach(c => { if(c.type === 'num') c.val = nums[nPointer++]; });
            } else {
                for(let col=0; col<size; col++) {
                    for(let row=0; row<size; row++) {
                        let idx = row * size + col;
                        if(cellsData[idx].type === 'num') cellsData[idx].val = nums[nPointer++];
                    }
                }
            }

            // Criar elementos HTML
            cellsData.forEach((data, index) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                if(data.type === 'free') {
                    cell.classList.add('free-space', 'marked');
                    cell.innerHTML = "‚≠ê<br>BINGO";
                } else {
                    cell.innerText = data.val;
                    cell.onclick = () => {
                        cell.classList.toggle('marked');
                        checkWin(grid, size, winMsg);
                    };
                }
                grid.appendChild(cell);
            });

            cardContainer.appendChild(winMsg);
            cardContainer.appendChild(grid);
            return cardContainer;
        }

        function checkWin(grid, size, winMsg) {
            const cells = grid.querySelectorAll('.cell');
            cells.forEach(c => { c.classList.remove('line-h'); c.classList.remove('line-v'); });

            let totalMarked = 0;

            for (let i = 0; i < size; i++) {
                let row = [], col = [];
                for (let j = 0; j < size; j++) {
                    row.push(i * size + j);
                    col.push(j * size + i);
                }

                if (row.every(idx => cells[idx].classList.contains('marked'))) {
                    row.forEach(idx => cells[idx].classList.add('line-h'));
                }
                if (col.every(idx => cells[idx].classList.contains('marked'))) {
                    col.forEach(idx => cells[idx].classList.add('line-v'));
                }
            }

            cells.forEach(c => { if(c.classList.contains('marked')) totalMarked++; });
            winMsg.style.display = (totalMarked === size * size) ? 'block' : 'none';
        }
    </script>
</body>
</html>
